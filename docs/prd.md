# MCP 데스크탑 자동화 프로젝트 - Product Requirements Document (PRD)

## 1. 프로젝트 개요

### 1.1 목적
ChatGPT 및 기타 LLM이 데스크탑 환경을 자동으로 제어할 수 있도록 하는 MCP (Model Context Protocol) 서버를 개발합니다. 이를 통해 LLM이 사용자의 자연어 명령을 받아 마우스, 키보드, 화면 등을 제어하고, 다양한 데스크탑 작업을 자동화할 수 있습니다.

### 1.2 기술 스택
- **언어**: Python 3.12+
- **핵심 라이브러리**:
  - `pyautogui`: 기본 데스크탑 자동화 (마우스, 키보드, 스크린샷)
  - `mcp`: Model Context Protocol 구현
  - `Pillow`: 이미지 처리
  - `pytesseract`: OCR (Optical Character Recognition)
  - `pywin32`: Windows 환경에서의 윈도우 관리
  - `keyboard`: 고급 키보드 제어
- **프레임워크**: PySide6 (기존 채팅 UI 통합용)

### 1.3 지원 방식
1. **독립 실행형 MCP 서버**: stdin/stdout을 통한 표준 MCP 프로토콜 서버
   - Claude Desktop, Cursor 등 MCP 클라이언트와 통합 가능
   - 별도 프로세스로 실행
2. **내장형 서버**: 기존 `aidesktop.py` 채팅 애플리케이션에 통합
   - 채팅 UI를 통해 직접 데스크탑 제어 기능 사용
   - WebChannel을 통한 Python-JavaScript 통신

## 2. 기능 요구사항

### 2.1 기본 자동화 기능

#### 2.1.1 마우스 제어
- **클릭**: 좌표 지정 클릭, 더블클릭, 우클릭, 중간 클릭
- **이동**: 절대 좌표 이동, 상대 좌표 이동
- **드래그**: 드래그 앤 드롭, 드래그로 선택
- **스크롤**: 수직/수평 스크롤, 스크롤 양 지정
- **위치 조회**: 현재 마우스 위치 반환

#### 2.1.2 키보드 제어
- **텍스트 입력**: 일반 텍스트 입력, 특수 문자 입력
- **단축키**: Ctrl, Alt, Shift 등 조합 키 입력
- **특수 키**: Enter, Tab, Escape, 화살표 키 등
- **키 상태**: 키 누름/떼기 개별 제어

#### 2.1.3 스크린샷 캡처
- **전체 화면**: 전체 화면 캡처
- **영역 지정**: 좌표로 지정한 영역 캡처
- **이미지 형식**: PNG, JPEG 지원
- **반환 방식**: Base64 인코딩 또는 파일 경로

#### 2.1.4 화면 정보 조회
- **해상도**: 화면 해상도 정보
- **색상**: 특정 좌표의 픽셀 색상 값
- **다중 모니터**: 여러 모니터 지원

### 2.2 고급 자동화 기능

#### 2.2.1 윈도우 조작
- **윈도우 찾기**: 제목, 클래스명, 프로세스명으로 윈도우 검색
- **윈도우 활성화**: 특정 윈도우를 포그라운드로 가져오기
- **윈도우 상태**: 최소화, 최대화, 복원
- **크기 조절**: 윈도우 크기 변경
- **위치 이동**: 윈도우 위치 변경
- **윈도우 정보**: 제목, 크기, 위치 등 정보 조회

#### 2.2.2 파일 시스템 접근
- **파일 읽기**: 텍스트 파일 읽기, 바이너리 파일 읽기
- **파일 쓰기**: 텍스트 파일 쓰기, 바이너리 파일 쓰기 (보안 고려)
- **디렉토리 탐색**: 디렉토리 목록 조회, 파일 검색
- **파일 정보**: 파일 크기, 수정 시간, 권한 등 조회

#### 2.2.3 OCR (Optical Character Recognition)
- **이미지 OCR**: 이미지 파일에서 텍스트 추출
- **화면 OCR**: 화면 영역을 캡처하여 텍스트 추출
- **언어 지원**: 한국어, 영어 기본 지원, 확장 가능
- **레이아웃 인식**: 텍스트 위치 정보 포함

#### 2.2.4 프로세스 관리
- **프로세스 실행**: 프로그램 실행
- **프로세스 종료**: 실행 중인 프로세스 종료
- **프로세스 목록**: 실행 중인 프로세스 목록 조회
- **프로세스 정보**: CPU, 메모리 사용량 등

#### 2.2.5 대기 및 타이밍 제어
- **대기**: 지정된 시간만큼 대기
- **조건 대기**: 특정 조건이 만족될 때까지 대기
- **타이밍 제어**: 작업 간 지연 시간 설정

### 2.3 MCP 통합

#### 2.3.1 MCP 프로토콜 지원
- **Tools**: 모든 자동화 기능을 MCP Tool로 노출
- **Resources**: 스크린샷, 시스템 정보 등을 Resource로 제공
- **Prompts**: 자주 사용되는 작업 패턴을 Prompt로 제공 (선택적)

#### 2.3.2 독립 실행형 서버
- **표준 프로토콜**: MCP 표준 프로토콜 준수
- **stdin/stdout 통신**: 표준 입출력을 통한 통신
- **에러 처리**: 표준 에러 응답 형식
- **로깅**: 구조화된 로깅 지원

#### 2.3.3 내장형 서버
- **채팅 UI 통합**: 기존 `aidesktop.py`와 통합
- **비동기 처리**: UI 블로킹 없이 작업 수행
- **상태 피드백**: 작업 진행 상황을 UI에 표시

## 3. 보안 및 안전성

### 3.1 권한 관리
- **실행 권한 확인**: 위험한 작업 전 권한 확인
- **제한된 작업**: 파일 삭제, 시스템 설정 변경 등 제한
- **사용자 확인**: 중요한 작업 전 사용자 확인 옵션

### 3.2 안전 기능
- **Fail-safe**: 마우스가 화면 모서리로 이동하면 모든 작업 중단
- **속도 제한**: 너무 빠른 작업 방지
- **에러 복구**: 예외 발생 시 안전한 상태로 복구

### 3.3 로깅 및 감사
- **작업 로깅**: 모든 자동화 작업 기록
- **감사 추적**: 누가, 언제, 무엇을 했는지 기록
- **로그 보관**: 로그 파일 관리

### 3.4 샌드박스 (향후)
- **제한된 영역**: 특정 디렉토리만 접근 가능
- **네트워크 제한**: 네트워크 접근 제한
- **시스템 보호**: 시스템 파일 보호

## 4. 사용 사례

### 4.1 기본 사용 사례
1. **파일 정리**: "다운로드 폴더의 이미지 파일들을 날짜별로 정리해줘"
2. **데이터 입력**: "이 Excel 파일의 데이터를 웹 폼에 입력해줘"
3. **스크린샷 분석**: "화면을 캡처해서 이 텍스트를 찾아줘"

### 4.2 고급 사용 사례
1. **웹 자동화**: "이 웹사이트에 로그인해서 주문 내역을 가져와줘"
2. **이미지 처리**: "스크린샷에서 텍스트를 추출해서 메모장에 저장해줘"
3. **멀티 앱 작업**: "Excel에서 데이터를 복사해서 PowerPoint에 붙여넣어줘"

## 5. 기술적 제약사항

### 5.1 플랫폼 지원
- **우선 지원**: Windows 10/11
- **향후 지원**: macOS, Linux (플랫폼별 라이브러리 필요)

### 5.2 성능
- **응답 시간**: MCP Tool 호출 시 1초 이내 응답 목표
- **리소스 사용**: 메모리 사용량 최소화
- **동시성**: 여러 작업 동시 처리 지원

### 5.3 호환성
- **MCP 버전**: MCP 최신 표준 준수
- **Python 버전**: Python 3.12 이상
- **의존성**: 최신 안정 버전 사용

## 6. 개발 우선순위

### 6.1 MVP (Minimum Viable Product)
1. 기본 MCP 서버 구조
2. 마우스 클릭/이동
3. 키보드 텍스트 입력
4. 스크린샷 캡처

### 6.2 Phase 1 (높은 우선순위)
5. 윈도우 찾기 및 활성화
6. 키보드 단축키
7. OCR 기본 기능

### 6.3 Phase 2 (중간 우선순위)
8. 파일 시스템 읽기
9. 드래그 앤 드롭
10. 프로세스 관리

### 6.4 Phase 3 (낮은 우선순위)
11. 파일 시스템 쓰기
12. 고급 OCR
13. 이미지 인식

## 7. 성공 지표

### 7.1 기능 지표
- 모든 MVP 기능 정상 작동
- MCP 표준 프로토콜 100% 준수
- 주요 사용 사례 80% 이상 자동화 가능

### 7.2 품질 지표
- 단위 테스트 커버리지 80% 이상
- 통합 테스트 통과율 100%
- 에러 발생률 1% 미만

### 7.3 사용성 지표
- 평균 작업 완료 시간 10초 이내
- 사용자 만족도 4.0/5.0 이상
- 문서화 완성도 100%

## 8. 향후 확장 계획

### 8.1 기능 확장
- 음성 명령 지원
- 컴퓨터 비전 기반 객체 인식
- 웹 브라우저 자동화 통합
- 스마트 워크플로우 빌더

### 8.2 플랫폼 확장
- macOS 지원
- Linux 지원
- 모바일 디바이스 제어 (향후)

### 8.3 통합 확장
- 다른 LLM 서비스 통합
- API 서버 제공
- 웹 대시보드 제공

## 9. 참고 자료

### 9.1 관련 문서
- [MCP 공식 문서](https://modelcontextprotocol.io/)
- [pyautogui 문서](https://pyautogui.readthedocs.io/)
- [Pillow 문서](https://pillow.readthedocs.io/)

### 9.2 표준 및 프로토콜
- Model Context Protocol Specification
- JSON-RPC 2.0 (MCP 기반)

---

**문서 버전**: 1.0  
**작성일**: 2024  
**최종 수정일**: 2024

